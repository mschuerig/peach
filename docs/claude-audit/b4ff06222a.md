---
commit: "b4ff06222aab77dc071a770f08af0eea542f77b3"
date: "2026-02-25T19:26:15+01:00"
author: "Michael SchÃ¼rig <michael@schuerig.de>"
subject: "Add v0.2 Pitch Matching epics and stories (Epics 11-18)"
sessions: ["7c10fdf6-b337-4c55-889d-3d8723234813"]
prev: "b4f086140a.md"
next: "9843da5a5f.md"
---

[â† Previous (b4f086140a)](b4f086140a.md) | [Index](index.md) | [Next (9843da5a5f) â†’](9843da5a5f.md)

# Commit b4ff06222a

**Date:** 2026-02-25 19:26:15 UTC+01:00  
**Author:** Michael SchÃ¼rig <michael@schuerig.de>

## Commit message

Add v0.2 Pitch Matching epics and stories (Epics 11-18)

8 epics, 13 stories covering FR44-FR52 and NFR13 for the pitch
matching training paradigm. Implementation sequence follows the
architecture amendment: prerequisite renames, PlaybackHandle redesign,
data model, profile split, session, UI, navigation, profile display.

Co-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>

## Changed files

```
docs/planning-artifacts/epics.md | 685 ++++++++++++++++++++++++++++++++++++++-
 1 file changed, 683 insertions(+), 2 deletions(-)
```

## Session `7c10fdf6â€¦`

*2026-02-25 16:35:32 UTC â†’ 2026-02-25 18:26:18 UTC*

### ğŸ§‘ Human (16:35:32)

<command-message>bmad-agent-bmm-pm</command-message>
<command-name>/bmad-agent-bmm-pm</command-name>
<command-args>Create epics and stories for v0.2 Pitch Matching based on the architecture amendment in docs/planning-artifacts/architecture.md (section "v0.2 Architecture Amendment â€” Pitch Matching"). The amendment includes an 8-step implementation sequence that must be respected as the epic ordering.

Critical: The first epic must be prerequisite renames and refactoring (TrainingSessionâ†’ComparisonSession, TrainingScreenâ†’ComparisonScreen, TrainingStateâ†’ComparisonSessionState, Training/â†’Comparison/, FeedbackIndicatorâ†’ComparisonFeedbackIndicator, NextNoteStrategyâ†’NextComparisonStrategy). This is pure refactoring with no functional changes â€” all tests must continue to pass. It unblocks everything else.

The second epic should be the PlaybackHandle/NotePlayer redesign â€” also a refactoring of existing code before new features are added.

Only after those two refactoring epics should the new-feature epics begin (data model, profile split, PitchMatchingSession, UI, integration).

Reference documents: docs/planning-artifacts/prd.md (FR44â€“FR52), docs/planning-artifacts/ux-design-specification.md (Pitch Matching amendment),  docs/planning-artifacts/architecture.md (v0.2 amendment), docs/project-context.md (implementation rules).</command-args>

### ğŸ¤– Assistant (16:35:47)

Hey Michael! John here, your Product Manager. 

I see you've come in hot with a clear mission â€” **Create Epics and Stories for v0.2 Pitch Matching**. That maps straight to my **[CE] Create Epics and Stories** workflow. Let me load that up and get us rolling.

For reference, here's my full menu if you need anything else later:

1. **[MH]** Redisplay Menu Help
2. **[CH]** Chat with the Agent about anything
3. **[CP]** Create PRD
4. **[VP]** Validate PRD
5. **[EP]** Edit PRD
6. **[CE]** Create Epics and Stories
7. **[IR]** Implementation Readiness
8. **[CC]** Course Correction
9. **[PM]** Start Party Mode
10. **[DA]** Dismiss Agent

You can type `/bmad-help` anytime for guidance, e.g. `/bmad-help where should I start with an idea I have that does XYZ`.

Now let me execute the CE workflow with your arguments.

### ğŸ¤– Assistant (16:35:51)

Good â€” workflow loaded. Config already resolved:
- **project_name**: peach
- **output_folder**: `docs/`
- **planning_artifacts**: `docs/planning-artifacts/`
- **communication_language**: English

Let me load Step 1 now.

### ğŸ¤– Assistant (16:35:57)

Alright Michael, welcome to the **Epic & Story Creation** workflow for Peach v0.2 Pitch Matching! 

Let's cut straight to what matters â€” validating we have the right inputs before we decompose anything.

## Step 1: Prerequisite Validation

Let me hunt down the required planning documents.

### ğŸ¤– Assistant (16:36:06)

All three documents found:

1. **PRD** â€” `docs/planning-artifacts/prd.md`
2. **Architecture** â€” `docs/planning-artifacts/architecture.md`
3. **UX Design** â€” `docs/planning-artifacts/ux-design-specification.md`

You also mentioned `docs/project-context.md` as a reference for implementation rules. 

**Before I proceed with extraction â€” are these 4 documents the complete set, or should I include/exclude anything?**

Since you've already scoped this to **v0.2 Pitch Matching** specifically, I'll focus my extraction on:
- **PRD**: FR44â€“FR52 (the pitch matching requirements)
- **Architecture**: v0.2 Architecture Amendment â€” Pitch Matching section
- **UX Design**: Pitch Matching amendment section
- **project-context.md**: for implementation rules/conventions that affect story acceptance criteria

Does that sound right, or should I cast a wider net?

### ğŸ§‘ Human (16:36:49)

go ahead. you may also want to look at the glossary.md

### ğŸ¤– Assistant (16:36:53)

Good call on the glossary â€” domain language matters for precise stories. Let me load everything up.

### ğŸ¤– Assistant (16:36:59)

Now let me get the glossary and the specific v0.2 sections from architecture and UX.

### ğŸ¤– Assistant (16:37:09)

Good â€” I have the PRD, glossary, and project context loaded. Now let me get the critical v0.2 architecture amendment section and the UX pitch matching amendment.

### ğŸ¤– Assistant (16:37:18)

Now let me get the UX pitch matching amendment section.

### ğŸ¤– Assistant (16:37:40)

All documents loaded. I now have a comprehensive picture. Let me also check if there's an existing epics file.

### ğŸ¤– Assistant (16:38:46)

All five documents fully loaded and analyzed. Here's what I extracted for **v0.2 Pitch Matching**:

---

## Requirements Extraction â€” v0.2 Pitch Matching

### Functional Requirements (10 FRs)

| FR | Description |
|---|---|
| **FR44** | User can start pitch matching training from the Start Screen via a dedicated button |
| **FR45** | System plays a reference note for the configured note duration, then plays a tunable note indefinitely |
| **FR46** | User can adjust the pitch of the tunable note in real time via a large vertical slider control |
| **FR47** | System stops the tunable note and records the result when the user releases the slider |
| **FR48** | System records pitch matching results: reference note, user's final pitch, error in cents, timestamp |
| **FR49** | System provides visual feedback showing the signed cent offset and directional proximity after the user releases the slider (post-release only). No visual feedback during active tuning |
| **FR50** | System discards incomplete pitch matching attempts on interruption (navigation away, backgrounding, phone call, headphone disconnect) |
| **FR50a** | System returns to Start Screen when foregrounded after being backgrounded during pitch matching |
| **FR51** | System supports indefinite note playback (no fixed duration) with explicit stop trigger |
| **FR52** | System supports real-time frequency adjustment of an actively playing note without audible artifacts |

### Non-Functional Requirements (1 new)

| NFR | Description |
|---|---|
| **NFR13** | Real-time pitch adjustment: slider input must produce audible frequency change within 20ms â€” no perceptible lag between gesture and sound |

Existing NFRs (1â€“12) remain applicable â€” audio latency, data integrity, accessibility, etc.

### Additional Requirements from Architecture

**Prerequisite Renames (6 operations, pure refactoring):**
- `TrainingSession` â†’ `ComparisonSession`
- `TrainingState` â†’ `ComparisonSessionState`
- `TrainingScreen` â†’ `ComparisonScreen`
- `Training/` directory â†’ `Comparison/`
- `FeedbackIndicator` â†’ `ComparisonFeedbackIndicator`
- `NextNoteStrategy` â†’ `NextComparisonStrategy`

**PlaybackHandle Pattern (NotePlayer redesign):**
- New `PlaybackHandle` protocol (`stop()`, `adjustFrequency()`)
- `NotePlayer.play()` returns `PlaybackHandle` â€” caller owns the note
- `stop()` removed from `NotePlayer` â€” stopping goes through handle only
- Fixed-duration convenience method via default protocol extension
- `SoundFontPlaybackHandle` implementation, `MockPlaybackHandle` for tests

**Data Model:**
- `PitchMatchingRecord` â€” new SwiftData `@Model`: referenceNote, initialCentOffset, userCentError, timestamp
- `TrainingDataStore` extended with pitch matching CRUD + `PitchMatchingObserver` conformance
- `ModelContainer` schema updated to include `PitchMatchingRecord`

**Profile Protocol Split:**
- `PitchDiscriminationProfile` â€” extracted protocol (existing PerceptualProfile behavior)
- `PitchMatchingProfile` â€” new protocol (matchingMean, matchingStdDev, matchingSampleCount)
- `PerceptualProfile` conforms to both, rebuilt from both record types at startup

**PitchMatchingSession State Machine:**
- States: `idle` â†’ `playingReference` â†’ `playingTunable` â†’ `showingFeedback` â†’ loop
- `PitchMatchingObserver` protocol + `CompletedPitchMatching` value type
- `PitchMatchingChallenge` value type (random note + random Â±100 cent offset for v0.2)
- Dependencies: NotePlayer, PitchMatchingProfile, observers â€” no adaptive strategy

**Project Structure:**
- `Training/` â†’ `Comparison/` directory rename
- New `PitchMatching/` feature directory
- `PeachApp.swift` wiring for PitchMatchingSession

### Additional Requirements from UX

- **Vertical Pitch Slider:** Custom `DragGesture`-based, large thumb (>>44pt), no markings, always starts center, states: inactive/active/dragging/released
- **Pitch Matching Feedback Indicator:** SF Symbol arrow + signed cent offset, green (<10Â¢) / yellow (10-30Â¢) / red (>30Â¢), green dot for dead center
- **Start Screen hierarchy:** Start Training (`.borderedProminent`) above Pitch Matching (`.bordered`)
- **Auto-start tunable note** after reference stops â€” no touch-to-start
- **No visual feedback during active tuning** â€” ears-only principle (non-negotiable)
- **Same ~400ms feedback duration** as comparison training
- **Same interruption patterns** as comparison training
- **VoiceOver:** `accessibilityAdjustableAction` for slider, custom labels for feedback ("4 cents sharp", "Dead center")
- **Profile Screen:** shows matching statistics alongside discrimination profile (empty state for cold start)

### Additional Requirements from Glossary

Domain terminology confirmed â€” all v0.2 terms (ComparisonSession, ComparisonSessionState, PlaybackHandle, PitchMatchingChallenge, CompletedPitchMatching, etc.) are defined and consistent across docs.

---

**10 FRs, 1 new NFR, 6 prerequisite renames, and a clean 8-step implementation sequence from the architecture amendment.**

Michael â€” do these extracted requirements accurately represent what needs to be built? Any additions or corrections before I proceed to epic design?

**Confirm the requirements are complete and correct to [C] continue:**

### ğŸ§‘ Human (16:41:03)

c

### ğŸ¤– Assistant (16:41:10)

Let me save the v0.2 requirements to the epics file and then load the next step.

### ğŸ¤– Assistant (16:41:27)

Requirements confirmed. Let me update the epics file with v0.2 requirements and then load step 2.

### ğŸ¤– Assistant (16:41:43)

Now let me add the v0.2 FRs to the functional requirements section and the new NFR.

### ğŸ¤– Assistant (16:41:53)

API Error: 500 {"type":"error","error":{"type":"api_error","message":"Internal server error"},"request_id":"req_011CYV7whzE1UdKbdehMtU7x"}

### ğŸ§‘ Human (16:43:55)

continue

### ğŸ¤– Assistant (16:44:03)

Now add v0.2 additional requirements and update the FR coverage map and epic list.

### ğŸ¤– Assistant (16:44:28)

Now add v0.2 FR coverage entries and epic list entries.

### ğŸ¤– Assistant (16:49:37)

Now add the v0.2 epic list entries after the existing ones.

### ğŸ¤– Assistant (16:49:40)

Good â€” requirements saved, frontmatter updated, epic list entries added. Now loading step 2.

### ğŸ¤– Assistant (16:50:18)

Step 2 loaded. Let me present the v0.2 epic design.

---

## v0.2 Epic Design â€” Pitch Matching

**8 epics following the architecture amendment's implementation sequence.**

I'll be direct about a tension: the workflow says "organize by user value, not technical layers." Your architecture amendment says "renames first, PlaybackHandle second, then features." Both are right â€” but the architecture wins here. The first two epics are pure refactoring with zero user-visible change, and that's exactly correct. Trying to interleave renames with feature work would create a mess. Clean foundation â†’ build on it. Here's the structure:

---

### Epic 11: Clear the Decks â€” Prerequisite Renames
All MVP names that are now ambiguous with two training modes are renamed to comparison-specific names. Pure refactoring â€” no functional changes, all tests continue to pass.
**FRs covered:** None (refactoring only â€” unblocks everything else)
**Dependencies:** None â€” first in sequence

### Epic 12: Own Every Note â€” PlaybackHandle Redesign
The NotePlayer protocol is redesigned around a PlaybackHandle that represents ownership of a playing note, enabling both fixed-duration playback (comparisons) and indefinite playback with real-time frequency adjustment (pitch matching).
**FRs covered:** FR51, FR52
**Dependencies:** Epic 11 (needs renamed types)

### Epic 13: Remember Every Match â€” Pitch Matching Data Layer
Pitch matching results are reliably stored alongside comparison records, extending the data foundation to support both training modes.
**FRs covered:** FR48
**Dependencies:** Epic 11 (needs renamed types)

### Epic 14: Know Both Skills â€” Profile Protocol Split
The perceptual profile is split into two protocol interfaces â€” pitch discrimination and pitch matching â€” so that each training mode depends only on the statistics it needs.
**FRs covered:** None (architectural refactoring enabling FR45â€“FR50a)
**Dependencies:** Epic 11 (needs renamed types), Epic 13 (PitchMatchingRecord for loading)

### Epic 15: Tune Your Ear â€” PitchMatchingSession
The pitch matching state machine orchestrates the complete training loop: reference note playback, indefinite tunable note, slider-driven frequency adjustment, result recording, and observer notification.
**FRs covered:** FR45, FR47, FR50, FR50a
**Dependencies:** Epic 12 (PlaybackHandle), Epic 13 (data model), Epic 14 (profile protocols)

### Epic 16: See and Slide â€” Pitch Matching Screen
Users interact with pitch matching through a custom vertical slider and receive post-release visual feedback showing their accuracy.
**FRs covered:** FR46, FR49
**NFRs covered:** NFR13
**Dependencies:** Epic 15 (PitchMatchingSession to observe)

### Epic 17: Two Modes, One App â€” Start Screen Integration
Users can access pitch matching from the Start Screen alongside comparison training, with proper navigation routing.
**FRs covered:** FR44
**Dependencies:** Epic 16 (PitchMatchingScreen to navigate to)

### Epic 18: The Full Picture â€” Profile Screen Integration
Users can see their pitch matching accuracy statistics alongside their discrimination profile on the Profile Screen.
**FRs covered:** Extends FR21â€“FR26 to include matching data
**Dependencies:** Epic 14 (PitchMatchingProfile protocol)

---

### FR Coverage Map (v0.2)

| FR | Epic | Description |
|---|---|---|
| FR44 | Epic 17 | Start pitch matching from Start Screen |
| FR45 | Epic 15 | Reference note + indefinite tunable note |
| FR46 | Epic 16 | Real-time pitch adjustment via slider |
| FR47 | Epic 15 | Stop tunable on slider release, record result |
| FR48 | Epic 13 | Pitch matching result recording |
| FR49 | Epic 16 | Post-release visual feedback (arrow + cents) |
| FR50 | Epic 15 | Discard incomplete pitch matching on interruption |
| FR50a | Epic 15 | Return to Start Screen on foreground |
| FR51 | Epic 12 | Indefinite note playback with explicit stop |
| FR52 | Epic 12 | Real-time frequency adjustment of playing note |

**All 10 FRs + 1 NFR covered. No gaps.**

---

### Dependency chain:

```
Epic 11 (renames)
  â”œâ”€â”€ Epic 12 (PlaybackHandle) â”€â”€â”
  â”œâ”€â”€ Epic 13 (data model) â”€â”€â”€â”€â”€â”€â”¤
  â””â”€â”€ Epic 14 (profile split) â”€â”€â”€â”¤
                                  â”œâ”€â”€ Epic 15 (session) â”€â”€ Epic 16 (UI) â”€â”€ Epic 17 (Start Screen)
                                  â””â”€â”€ Epic 18 (Profile Screen)
```

Epics 12, 13, 14 can potentially be worked in parallel after 11 completes. Epics 15â€“17 are strictly sequential. Epic 18 can start after 14.

---

Michael â€” does this epic structure align with your vision? Should we adjust any groupings or reorder anything?

**Select an Option:** [C] Continue to story creation

### ğŸ§‘ Human (16:53:42)

go ahead

### ğŸ¤– Assistant (16:53:52)

Loading step 3 â€” story creation.

### ğŸ¤– Assistant (16:53:55)

API Error: 500 {"type":"error","error":{"type":"api_error","message":"Internal server error"},"request_id":"req_011CYV8rth8ba38XAUL2GpDC"}

### ğŸ§‘ Human (16:54:50)

continue

### ğŸ¤– Assistant (16:56:08)

Epics approved. Let me now create the stories for all 8 v0.2 epics. I'll work through each one and append to the epics file.

Let me check where to append.

### ğŸ¤– Assistant (16:56:19)

Now I'll write all v0.2 stories. This is 8 epics â€” let me draft them all and append to the file.

### ğŸ¤– Assistant (16:58:39)

All 8 epics with 13 stories written and saved. Let me update the frontmatter.

### ğŸ¤– Assistant (16:58:43)

API Error: 500 {"type":"error","error":{"type":"api_error","message":"Internal server error"},"request_id":"req_011CYV9EBJ77qBmLafn9UfiB"}

### ğŸ§‘ Human (17:00:58)

continue

### ğŸ¤– Assistant (17:00:59)

API Error: 500 {"type":"error","error":{"type":"api_error","message":"Internal server error"},"request_id":"req_011CYV9QA9fyBffZQzVDr6HS"}

### ğŸ§‘ Human (18:19:35)

continue and make sure that the API Errors have caused no damage.

### ğŸ¤– Assistant (18:19:41)

Let me first verify the file integrity, then proceed to validation.

### ğŸ¤– Assistant (18:19:48)

All 8 epics and 13 stories present and intact. Let me also verify the frontmatter and requirements sections survived.

### ğŸ¤– Assistant (18:19:54)

File is clean â€” frontmatter, all 10 v0.2 FRs, NFR13, 8 epics, 13 stories all intact. No damage from API errors.

Now loading step 4 â€” final validation.

### ğŸ¤– Assistant (18:20:42)

Running final validation against all checks.

---

## Final Validation Report

### 1. FR Coverage â€” All 10 v0.2 FRs Covered

| FR | Story | Status |
|---|---|---|
| FR44 | 17.1 (Pitch Matching button + navigation) | Covered |
| FR45 | 15.1 (reference note + indefinite tunable) | Covered |
| FR46 | 16.1 (VerticalPitchSlider) + 16.3 (wiring) | Covered |
| FR47 | 15.1 (commitResult stops note, records) | Covered |
| FR48 | 13.1 (PitchMatchingRecord + TrainingDataStore) | Covered |
| FR49 | 16.2 (PitchMatchingFeedbackIndicator) | Covered |
| FR50 | 15.2 (interruption handling) | Covered |
| FR50a | 15.2 (background â†’ Start Screen) | Covered |
| FR51 | 12.1 (indefinite playback via PlaybackHandle) | Covered |
| FR52 | 12.1 (adjustFrequency on PlaybackHandle) | Covered |

**NFR13** (20ms slider-to-sound latency): Addressed by Epic 12 (PlaybackHandle.adjustFrequency) + Epic 16 (slider â†’ session wiring). Covered.

**No gaps.**

### 2. Architecture Compliance

- No starter template step needed â€” adding to existing project
- No upfront entity creation â€” `PitchMatchingRecord` created in Epic 13 exactly when the data layer needs it
- Implementation sequence matches architecture amendment exactly: renames â†’ PlaybackHandle â†’ data â†’ profile â†’ session â†’ UI â†’ Start Screen â†’ Profile Screen
- All file locations specified in stories match the architecture's updated project structure

### 3. Story Quality

| Check | Result |
|---|---|
| Each story completable by single dev agent | 13/13 pass â€” largest is 15.1 (state machine) which is a single-responsibility component |
| Acceptance criteria in Given/When/Then | 13/13 pass |
| Technical details sufficient for implementation | 13/13 pass â€” protocol signatures, file locations, state transitions all specified |
| Forward dependencies | 0 violations (see below) |

### 4. Epic Structure

- Epics 11-12: Refactoring â€” no direct user value but architecturally mandatory (explicitly justified and approved)
- Epics 13-14: Data/profile foundation â€” minimal user value but enables feature epics
- Epics 15-18: Full user-facing value â€” session, UI, navigation, profile display

### 5. Dependency Validation

**Cross-epic dependencies (all forward-flowing):**

```
Epic 11 (standalone)
  â†’ Epic 12 (depends on 11)
  â†’ Epic 13 (depends on 11)
  â†’ Epic 14 (14.1 depends on 11; 14.2 depends on 11+13)
     â†’ Epic 15 (depends on 12+13+14)
        â†’ Epic 16 (depends on 15)
           â†’ Epic 17 (depends on 16)
     â†’ Epic 18 (depends on 14)
```

No backward dependencies. Each epic functions with only its predecessors.

**Within-epic story dependencies (all sequential):**

| Epic | Story flow | Status |
|---|---|---|
| 11 | Single story | N/A |
| 12 | 12.1 (protocols/impl) â†’ 12.2 (consumer) | Forward only |
| 13 | Single story | N/A |
| 14 | 14.1 (extract existing) â†’ 14.2 (add new) | Forward only |
| 15 | 15.1 (core loop) â†’ 15.2 (interruptions) | Forward only |
| 16 | 16.1 (slider) â†’ 16.2 (feedback) â†’ 16.3 (assembly) | 16.1 and 16.2 are independent; 16.3 depends on both |
| 17 | Single story | N/A |
| 18 | Single story | N/A |

No violations.

---

## Summary

**8 epics, 13 stories, 10 FRs + 1 NFR â€” complete coverage, no gaps, no dependency violations.**

**All validations pass.** [C] Complete Workflow

### ğŸ§‘ Human (18:24:24)

c

### ğŸ¤– Assistant (18:24:41)

Workflow complete. The v0.2 Pitch Matching epics and stories are saved to `docs/planning-artifacts/epics.md`.

**What was delivered:**

- **8 epics** (11â€“18) following the architecture amendment's implementation sequence exactly
- **13 stories** with full Given/When/Then acceptance criteria
- **10 FRs** (FR44â€“FR52) + **1 NFR** (NFR13) â€” complete coverage, validated
- **Dependency chain** validated â€” no backward dependencies, all stories implementable in sequence
- Requirements inventory, FR coverage map, and additional requirements sections all updated

**The implementation sequence:**
1. **Epic 11** â€” Prerequisite renames (pure refactoring)
2. **Epic 12** â€” PlaybackHandle redesign (2 stories)
3. **Epic 13** â€” Pitch matching data layer (1 story)
4. **Epic 14** â€” Profile protocol split (2 stories)
5. **Epic 15** â€” PitchMatchingSession (2 stories)
6. **Epic 16** â€” Pitch Matching Screen (3 stories)
7. **Epic 17** â€” Start Screen integration (1 story)
8. **Epic 18** â€” Profile Screen integration (1 story)

Any questions about the epics or stories, Michael?

### ğŸ§‘ Human (18:26:03)

commit this

### ğŸ¤– Assistant (18:26:12)

Single file changed. Clean diff â€” v0.2 content appended to existing epics.

### ğŸ¤– Assistant (18:26:18)

Committed: `b4ff062` â€” 683 lines added, working tree clean.

---

[â† Previous (b4f086140a)](b4f086140a.md) | [Index](index.md) | [Next (9843da5a5f) â†’](9843da5a5f.md)
