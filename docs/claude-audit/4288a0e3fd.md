---
commit: "4288a0e3fd7709974989e49ef16528d2b5555b6c"
date: "2026-02-22T22:56:14+01:00"
author: "Michael Sch√ºrig <michael@schuerig.de>"
subject: "Add story for fix-feedback-icon-flicker-on-correctness-change"
sessions: ["f94c4368-6ab0-412b-b0d2-513cf30b74a9"]
prev: "aafd7821f3.md"
next: "459a004ebc.md"
---

[‚Üê Previous (aafd7821f3)](aafd7821f3.md) | [Index](index.md) | [Next (459a004ebc) ‚Üí](459a004ebc.md)

# Commit 4288a0e3fd

**Date:** 2026-02-22 22:56:14 UTC+01:00  
**Author:** Michael Sch√ºrig <michael@schuerig.de>

## Commit message

Add story for fix-feedback-icon-flicker-on-correctness-change

Co-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>

## Changed files

```
...-feedback-icon-flicker-on-correctness-change.md | 159 +++++++++++++++++++++
 docs/implementation-artifacts/sprint-status.yaml   |   2 +-
 2 files changed, 160 insertions(+), 1 deletion(-)
```

## Session `f94c4368‚Ä¶`

*2026-02-22 21:47:44 UTC ‚Üí 2026-02-22 21:56:17 UTC*

### üßë Human (21:47:44)

<command-message>bmad-bmm-create-story</command-message>
<command-name>/bmad-bmm-create-story</command-name>
<command-args>fix-feedback-icon-flicker-on-correctness-change</command-args>

### ü§ñ Assistant (21:47:46)

I'll start by loading the workflow engine and the specific workflow configuration.

### ü§ñ Assistant (21:47:51)

Now I'll load the config source, template, instructions, and project context.

### ü§ñ Assistant (21:48:07)

Good. All core files loaded. Let me now resolve variables and begin executing the workflow instructions.

**Resolved Variables:**
- `user_name`: Michael
- `communication_language`: English
- `document_output_language`: English
- `planning_artifacts`: `/Users/michael/Projekte/peach/docs/planning-artifacts`
- `implementation_artifacts`: `/Users/michael/Projekte/peach/docs/implementation-artifacts`
- `story_dir`: `/Users/michael/Projekte/peach/docs/implementation-artifacts`
- `date`: 2026-02-22
- `installed_path`: `/Users/michael/Projekte/peach/_bmad/bmm/workflows/4-implementation/create-story`

---

## Step 1: Determine Target Story

The user provided: `fix-feedback-icon-flicker-on-correctness-change`

This doesn't match a standard epic-story number format. Let me check for the sprint status file to find this story.

### ü§ñ Assistant (21:48:18)

Found it. The story `fix-feedback-icon-flicker-on-correctness-change` is in the sprint section with status `backlog`. The comment says: *"Feedback icon briefly shows previous icon before current"*.

**Parsed variables:**
- `story_key`: `fix-feedback-icon-flicker-on-correctness-change`
- `story_title`: Fix Feedback Icon Flicker on Correctness Change
- `default_output_file`: `/Users/michael/Projekte/peach/docs/implementation-artifacts/fix-feedback-icon-flicker-on-correctness-change.md`

This is a standalone fix story (not under a numbered epic), so no epic status update needed.

---

## Step 2: Load and Analyze Core Artifacts

Let me invoke the `discover_inputs` protocol and analyze the codebase for this bug.

### ü§ñ Assistant (21:48:26)

Good - all artifact files exist as single files. Now let me do exhaustive analysis. Since this is a UI bug about feedback icon flickering, I need to deeply understand the feedback UI, training session state machine, and recent related work. Let me research in parallel.

### ü§ñ Assistant (21:49:22)

Excellent research. Now let me verify the key source files directly to confirm the root cause analysis.

### ü§ñ Assistant (21:49:26)

Now let me read the TrainingSession feedback-related code.

### ü§ñ Assistant (21:50:45)

Now I have complete understanding of the bug. Let me also quickly check the checklist for validation later.

### ü§ñ Assistant (21:51:02)

Good, checklist loaded. Now I have all the context I need. Let me proceed to **Step 3** (Architecture analysis) and **Step 4** (Web research) ‚Äî both are already covered by my research agents above, which thoroughly analyzed the architecture constraints and current framework patterns. No web research is needed since this is a SwiftUI animation bug using standard framework APIs.

---

## Step 5: Create Comprehensive Story File

### Root Cause Summary

The bug is in `TrainingScreen.swift` (lines 46-53). The feedback overlay uses manual `.opacity()` toggled by `showFeedback`, with `.animation(value: showFeedback)`. The `FeedbackIndicator` always exists in the view tree (even when invisible at opacity 0) and retains the previous `isLastAnswerCorrect` value. When a new answer produces a different correctness result, SwiftUI may render a frame showing the stale icon as the opacity animation begins, before the new icon replaces it.

**Fix approach:** Replace the manual `.opacity()` toggle with a conditional `if` + `.transition(.opacity)` pattern. This fully removes/recreates the `FeedbackIndicator` view on each show/hide cycle, eliminating stale icon state.

---

Now let me write the story file, section by section. Starting with the **Story Header**:

### ü§ñ Assistant (21:52:11)

Story file created. Here's a summary of the key sections:

**Story:** Fix feedback icon flicker when correctness changes between consecutive answers.

**Root Cause:** The `FeedbackIndicator` view persists in the view tree (hidden via `.opacity(0)`) and retains the previous icon. When a new answer with different correctness arrives, SwiftUI may briefly render the stale icon as the opacity animation transitions.

**Fix:** Replace `.opacity()` toggling with conditional `if` + `.transition(.opacity)` ‚Äî a 6-line change in `TrainingScreen.swift` (lines 46-53). The view is fully removed when hidden and recreated fresh each cycle, eliminating stale state.

**Scope:** Single file change (`TrainingScreen.swift`), no changes to `FeedbackIndicator.swift` or `TrainingSession.swift`.

**7 Acceptance Criteria** covering correctness transitions, first comparison, Reduce Motion, timing preservation, and regression safety.

---

Choose how to proceed:
- **[a]** Advanced Elicitation ‚Äî deep-dive discussion on any section
- **[c]** Continue to validation step
- **[p]** Party-Mode
- **[y]** YOLO ‚Äî auto-complete remaining steps

### üßë Human (21:53:22)

c

### ü§ñ Assistant (21:53:31)

## Step 6: Validate and Finalize

Running a quick validation pass against the checklist, then updating sprint status.

### ü§ñ Assistant (21:54:13)

Validation **PASSED** across all checks ‚Äî no critical issues found. Now updating sprint status.

### ü§ñ Assistant (21:54:22)

---

**STORY CONTEXT CREATED, Michael!**

**Story Details:**
- **Story Key:** `fix-feedback-icon-flicker-on-correctness-change`
- **File:** `docs/implementation-artifacts/fix-feedback-icon-flicker-on-correctness-change.md`
- **Status:** ready-for-dev
- **Validation:** PASSED (all checks green)

**Summary:** Single-file fix in `TrainingScreen.swift` ‚Äî replace permanent-view + `.opacity()` pattern with conditional `if` + `.transition(.opacity)` to eliminate stale feedback icon state between consecutive answers.

**Next Steps:**
1. Review the story in `docs/implementation-artifacts/fix-feedback-icon-flicker-on-correctness-change.md`
2. Run `dev-story` for implementation
3. Run `code-review` when complete

### üßë Human (21:56:03)

commit

### ü§ñ Assistant (21:56:11)

Two changes: the new story file and the sprint status update. Committing now.

### ü§ñ Assistant (21:56:17)

Committed: `4288a0e` ‚Äî Add story for fix-feedback-icon-flicker-on-correctness-change

---

[‚Üê Previous (aafd7821f3)](aafd7821f3.md) | [Index](index.md) | [Next (459a004ebc) ‚Üí](459a004ebc.md)
